---
/** Pagination Component — Design C Aesthetic */

const page: any = Astro.props.page;
const urlPattern: any = Astro.props.urlPattern;

/** Helper to build a URL for a given page number */
function buildUrl(pageNumber: number): string {
  if (urlPattern) {
    return pageNumber === 1
      ? urlPattern.replace("{}", "")
      : urlPattern.replace("{}", pageNumber.toString());
  }
  if (pageNumber === page.currentPage) return "#";
  if (pageNumber < page.currentPage && page.url.prev) {
    return page.url.prev.replace(/\d+(?=\/?$)/, pageNumber.toString());
  }
  if (pageNumber > page.currentPage && page.url.next) {
    return page.url.next.replace(/\d+(?=\/?$)/, pageNumber.toString());
  }
  return urlPattern
    ? urlPattern.replace("{}", pageNumber === 1 ? "" : pageNumber.toString())
    : "#";
}

/** Compute the list of page numbers (including ellipsis) to display */
function getPageNumbers(windowSize = 5): (number | "...")[] {
  const total = page.lastPage;
  const current = page.currentPage;
  const half = Math.floor(windowSize / 2);
  let start = Math.max(1, current - half);
  let end = Math.min(total, current + half);

  if (current - half < 1) {
    end = Math.min(total, end + (half - current + 1));
  }
  if (current + half > total) {
    start = Math.max(1, start - (current + half - total));
  }

  const pages: number[] = [];
  for (let i = start; i <= end; i++) pages.push(i);

  const result: (number | "...")[] = [];
  if (pages[0] > 1) {
    result.push(1);
    if (pages[0] > 2) result.push("...");
  }
  result.push(...pages);
  if (pages[pages.length - 1] < total) {
    if (pages[pages.length - 1] < total - 1) result.push("...");
    result.push(total);
  }
  return result;
}

const pageNumbers = getPageNumbers();
---

<nav class="pagination" aria-label="Pagination">
  <div class="pagination-inner">
    {
      page.url.prev ? (
        <a href={page.url.prev} class="nav-btn prev" rel="prev">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="m15 18-6-6 6-6" />
          </svg>
          <span>Anterior</span>
        </a>
      ) : (
        <span class="nav-btn disabled prev">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="m15 18-6-6 6-6" />
          </svg>
          <span>Anterior</span>
        </span>
      )
    }

    <div class="page-numbers">
      {
        pageNumbers.map((p) =>
          typeof p === "number" ? (
            p === page.currentPage ? (
              <span class="page-num current" aria-current="page">
                {p}
              </span>
            ) : (
              <a href={buildUrl(p)} class="page-num">
                {p}
              </a>
            )
          ) : (
            <span class="ellipsis">…</span>
          ),
        )
      }
    </div>

    {
      page.url.next ? (
        <a href={page.url.next} class="nav-btn next" rel="next">
          <span>Siguiente</span>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="m9 18 6-6-6-6" />
          </svg>
        </a>
      ) : (
        <span class="nav-btn disabled next">
          <span>Siguiente</span>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="m9 18 6-6-6-6" />
          </svg>
        </span>
      )
    }
  </div>
</nav>

<style>
  .pagination {
    margin: 4rem 0;
    display: flex;
    justify-content: center;
  }

  .pagination-inner {
    display: flex;
    align-items: center;
    gap: 1rem;
    background: var(--surface);
    padding: 0.5rem;
    border-radius: 60px;
    border: 1px solid var(--border);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.03);
  }

  .nav-btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.6rem 1.25rem;
    border-radius: 50px;
    font-size: 0.85rem;
    font-weight: 700;
    text-decoration: none;
    color: var(--text-sec);
    transition: all 0.2s;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .nav-btn:not(.disabled):hover {
    background: var(--colombia-y);
    color: var(--text);
  }

  .nav-btn.disabled {
    color: var(--text-subtle);
    cursor: not-allowed;
    opacity: 0.5;
  }

  .page-numbers {
    display: flex;
    align-items: center;
    gap: 0.25rem;
  }

  .page-num {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    font-size: 0.9rem;
    font-weight: 600;
    text-decoration: none;
    color: var(--text-sec);
    transition: all 0.2s;
  }

  .page-num.current {
    background: var(--colombia-gold);
    color: var(--text);
  }

  .page-num:not(.current):hover {
    background: rgba(245, 158, 11, 0.1);
    color: var(--colombia-gold);
  }

  .ellipsis {
    color: var(--text-subtle);
    padding: 0 0.25rem;
  }

  @media (max-width: 640px) {
    .page-numbers {
      display: none;
    }
    .pagination-inner {
      gap: 0.5rem;
      width: 100%;
      justify-content: space-between;
    }
    .nav-btn span {
      display: none;
    }
    .nav-btn {
      padding: 0.6rem;
    }
  }
</style>
