---
import type { CollectionEntry } from "astro:content";

import Layout from "./Layout.astro";
import FormattedDate from "../components/FormattedDate.astro";
import LazyImage from "../components/LazyImage.astro";
import ReadingProgress from "../components/ReadingProgress.astro";
import ShareButtons from "../components/ShareButtons.astro";
import AuthorCard from "../components/AuthorCard.astro";
import FallbackImage from "../assets/blog-placeholder-1.jpg";

type Props = CollectionEntry<"articulos">["data"];

const {
    title,
    description,
    pubDate,
    updatedDate,
    heroImage,
    heroImageAlt,
    categories,
    tags,
    author,
} = Astro.props;
---

<Layout
    title={title}
    description={description || "Análisis político y periodístico"}
    image={heroImage}
>
    <ReadingProgress />

    <article class="min-h-screen bg-base-100 pb-20">
        {/* Article Meta Data for SEO */}
        <meta property="article:published_time" content={pubDate.toISOString()} />
        {updatedDate && <meta property="article:modified_time" content={updatedDate.toISOString()} />}
        <meta property="article:author" content={author || "Lucio Torres"} />
        {categories?.map(cat => <meta property="article:section" content={cat} />)}
        {tags?.map(tag => <meta property="article:tag" content={tag} />)}
        {/* Header Wrapper with Dark Background */}
        <div
            class="relative py-32 px-6 text-center text-white overflow-hidden"
            style="background: var(--gradient-hero)"
        >
            <div
                class="absolute inset-0 bg-[radial-gradient(circle_at_50%_30%,rgba(245,158,11,0.15)_0%,transparent_60%)]"
            >
            </div>

            <header class="relative z-10 max-w-4xl mx-auto">
                {
                    categories && categories.length > 0 && (
                        <div class="flex gap-2 justify-center flex-wrap mb-8">
                            {categories.map((cat) => (
                                <span class="bg-white/10 text-primary border border-primary/30 px-5 py-1.5 rounded-full text-xs font-black tracking-widest uppercase backdrop-blur-sm">
                                    {cat}
                                </span>
                            ))}
                        </div>
                    )
                }

                <h1
                    class="font-editorial text-4xl sm:text-5xl md:text-7xl font-normal leading-tight tracking-tight text-white mb-8"
                >
                    {title}
                </h1>

                <div
                    class="flex items-center justify-center gap-6 flex-wrap text-sm text-white/70"
                >
                    <span class="font-bold text-white flex items-center gap-2">
                        Por {author || "Lucio Torres"}
                    </span>
                    <span class="w-1 h-1 rounded-full bg-white/30"></span>
                    <FormattedDate date={pubDate} />
                    {
                        updatedDate && (
                            <>
                                <span class="w-1 h-1 rounded-full bg-white/30" />
                                <span class="italic">
                                    Actualizado:{" "}
                                    <FormattedDate date={updatedDate} />
                                </span>
                            </>
                        )
                    }
                </div>
            </header>
        </div>

        {/* Hero Image - Overlapping */}
        {
            heroImage && (
                <div class="max-w-5xl mx-auto -mt-20 px-6 relative z-10">
                    <div class="rounded-3xl overflow-hidden shadow-2xl border-4 border-white/10">
                        <LazyImage
                            src={heroImage}
                            alt={heroImageAlt || title}
                            width={1000}
                            height={560}
                            aspectRatio="16/9"
                            priority={true}
                        />
                    </div>
                </div>
            )
        }

        {/* Article Content */}
        <div class="max-w-3xl mx-auto px-6 pt-16">
            <div
                class="prose prose-lg prose-neutral max-w-none prose-headings:font-editorial prose-headings:font-bold prose-a:text-primary prose-img:rounded-2xl"
            >
                <slot />
            </div>

            {/* Tags */}
            {
                tags && tags.length > 0 && (
                    <div class="mt-16 pt-8 border-t border-base-200 flex flex-wrap gap-2">
                        {tags.map((tag) => (
                            <span class="text-neutral/60 px-4 py-2 border border-base-200 rounded-full text-sm font-medium hover:border-primary hover:text-primary hover:bg-primary/5 transition-all">
                                #{tag}
                            </span>
                        ))}
                    </div>
                )
            }

            {/* Author Card */}
            <div class="my-16">
                <AuthorCard author={author || "Lucio Torres"} />
            </div>

            {/* Share Buttons */}
            <div class="flex justify-center mb-16">
                <ShareButtons title={title} />
            </div>
        </div>
    </article>

    <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"
    ></script>
</Layout>
